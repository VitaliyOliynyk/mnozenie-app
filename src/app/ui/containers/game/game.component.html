<div class="game-wrapper">


    @if (game.currentTask(); as task) {
    <div class="game-board">
        <app-task-display [task]="task"></app-task-display>

        <button class="settings-btn" (click)="toggleSettings()" aria-label="Ustawienia">⚙️</button>

        <div class="feedback-overlay" [class.show]="feedbackState() === 'result'"
            [class.correct]="game.lastResult() === true" [class.wrong]="game.lastResult() === false">
            @if (game.lastResult() === true) {
            <span class="icon">✅</span> Dobrze!
            } @else if (game.lastResult() === false) {
            <span class="icon">❌</span> Źle!
            }
        </div>

        @if (feedbackState() === 'correction' && game.settings().mode() === GameMode.Input) {
        <div class="correction-banner">
            <span class="label">Prawidłowa odpowiedź:</span>
            <span class="value">{{ task.solution() }}</span>
        </div>
        }

        @if (game.lastResult() === null || feedbackState() !== 'idle') {
        @if (game.settings().mode() === GameMode.Choice) {
        <app-answer-choices [options]="game.options()" [correctAnswer]="task.solution()"
            [highlight]="feedbackState() === 'correction'" [disabled]="feedbackState() !== 'idle'"
            (choice)="feedbackState() === 'idle' && game.checkAnswer($event)">
        </app-answer-choices>
        } @else {
        <app-answer-input [disabled]="feedbackState() !== 'idle'"
            (answer)="feedbackState() === 'idle' && game.checkAnswer($event)"></app-answer-input>
        }
        }
    </div>
    }

    <app-stats [stats]="game.stats()" (reset)="game.resetStats()"></app-stats>

    @if (showSettings()) {
    <app-settings [currentSettings]="game.settings()" (save)="onSettingsSave($event)" (close)="toggleSettings()">
    </app-settings>
    }
</div>