<div class="game-wrapper">

    @if (feedbackState() !== 'idle') {
    <div class="disabled-overlay"></div>
    }
    @if (game.currentTask(); as task) {
    <div class="game-board">
        <div class="task-header">
            <app-task-display [task]="task"
                [userAnswer]="game.settings().mode() === GameMode.Input ? currentInputValue() : ''">
            </app-task-display>
            <button class="settings-btn" (click)="toggleSettings()" aria-label="Ustawienia">⚙️</button>
        </div>


        <app-feedback-banner
            [type]="game.lastResult() === true ? 'correct' : (game.lastResult() === false ? 'wrong' : null)"
            [show]="feedbackState() === 'result'">
        </app-feedback-banner>


        @if (feedbackState() === 'correction' && game.settings().mode() === GameMode.Input) {
        <div class="correction-banner">
            <span class="label">Prawidłowa odpowiedź:</span>
            <span class="value">{{ task.solution() }}</span>
        </div>
        }

        @if (game.lastResult() === null || feedbackState() !== 'idle') {
        @if (game.settings().mode() === GameMode.Choice) {
        <app-answer-choices [options]="game.options()" [correctAnswer]="task.solution()"
            [highlight]="feedbackState() === 'correction'" [disabled]="feedbackState() !== 'idle'"
            (choice)="feedbackState() === 'idle' && game.checkAnswer($event)">
        </app-answer-choices>
        } @else {
        <app-answer-input [disabled]="feedbackState() !== 'idle'" (valueChange)="onInputValueChange($event)"
            (answer)="feedbackState() === 'idle' && game.checkAnswer($event)">
        </app-answer-input>
        }
        }
    </div>
    }

    <app-stats [stats]="game.stats()" (reset)="game.resetStats()"></app-stats>

    @if (showSettings()) {
    <app-settings [currentSettings]="game.settings()" (save)="onSettingsSave($event)" (close)="toggleSettings()">
    </app-settings>
    }
</div>